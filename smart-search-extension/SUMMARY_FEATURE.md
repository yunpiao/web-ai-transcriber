# 浏览记录总结功能

## 功能概述

这个功能允许用户基于**当前筛选的浏览记录**生成智能总结，并将总结发送到AI转写界面进行智能分析。支持按日期、时间段、关键词等多种筛选条件。

## 使用方法

1. **启用浏览记录追踪**
   - 打开扩展的设置页面（右键点击扩展图标 → 选项）
   - 勾选"启用页面浏览记录追踪"
   - 点击"保存设置"

2. **浏览网页**
   - 在任何网页停留超过5秒，系统会自动记录
   - 记录包含：网页标题、URL、访问时间、页面完整内容、停留时长

3. **查看浏览记录**
   - 右键点击扩展图标 → 选择"浏览历史记录"
   - 或者直接访问 `chrome-extension://[扩展ID]/history.html`

4. **筛选并总结浏览记录**
   - 在历史记录页面，使用筛选功能选择你想总结的记录：
     - 快速筛选：今天、昨天、本周
     - 日历筛选：选择特定日期和小时
     - 关键词搜索：按标题、URL或域名搜索
   - 点击"📝 总结筛选结果"按钮
   - 系统会基于当前筛选的记录生成总结
   - 自动打开AI转写界面（根据您的设置）

## 总结内容包含

总结会包含以下信息：

1. **筛选条件描述**
   - 显示使用的筛选条件（日期、时间、关键词等）
   - 记录总数

2. **浏览记录列表（完整信息）**
   - 每条记录的完整日期和时间
   - 网页标题
   - 完整URL
   - 域名
   - **页面停留时长**
   - **完整页面内容**（不再截断）

3. **分析要求**
   - 主要浏览的网站和类型
   - 关注的主要话题或领域
   - 浏览时间分布特点
   - 建议和洞察

## 技术特点

### 智能筛选
- 支持多种筛选条件组合
- 按时间顺序排序
- 过滤无效记录

### 内容优化
- **使用完整页面内容，不截断**（提供更多上下文给AI）
- 包含页面停留时长信息
- 空内容自动跳过
- 防御性编程，处理各种边界情况

### 灵活配置
- 支持所有转写引擎（Gemini、Qwen、DeepSeek、AI Studio）
- 可选择在当前标签页或新标签页打开
- 不会添加默认的转写提示词模板（使用专门的总结提示词）

## 示例输出

### 示例1：总结今天的浏览记录

```
请帮我总结以下浏览记录（筛选条件：今天），共 5 个网页。以下是详细的浏览记录：

1. [2024-01-15 10:30] GitHub - 项目管理
   网址: https://github.com/myproject
   域名: github.com
   停留时长: 15分30秒
   页面内容: [完整的页面文本内容，不截断]

2. [2024-01-15 14:20] Chrome扩展开发文档
   网址: https://developer.chrome.com/docs/extensions/
   域名: developer.chrome.com
   停留时长: 8分
   页面内容: [完整的页面文本内容，不截断]

...

请根据以上浏览记录，总结浏览主题和关注重点，并给出以下内容：
1. 主要浏览的网站和类型
2. 关注的主要话题或领域
3. 浏览时间分布特点
4. 建议和洞察（如果有的话）
```

### 示例2：总结特定搜索结果

```
请帮我总结以下浏览记录（筛选条件：搜索"Chrome扩展"），共 3 个网页。以下是详细的浏览记录：

1. [2024-01-15 14:20] Chrome扩展开发文档
   网址: https://developer.chrome.com/docs/extensions/
   域名: github.com
   内容摘要: 查看项目的最新提交和问题...

2. [11:15] Stack Overflow - JavaScript问题
   网址: https://stackoverflow.com/questions/12345
   域名: stackoverflow.com
   内容摘要: 关于异步编程的讨论...

...

请根据以上浏览记录，总结今天的浏览主题和关注重点，并给出以下内容：
1. 主要浏览的网站和类型
2. 关注的主要话题或领域
3. 浏览时间分布特点
4. 建议和洞察（如果有的话）
```

## 注意事项

1. **需要先有记录**
   - 如果今天还没有浏览记录，会提示"今天还没有浏览记录"
   - 需要先启用浏览记录追踪功能

2. **隐私保护**
   - 所有数据存储在本地IndexedDB中
   - 不会上传到任何服务器
   - 可以随时清空所有记录

3. **转写引擎配置**
   - 在设置页面选择您喜欢的AI引擎
   - 总结功能会使用相同的引擎设置

4. **弹窗拦截**
   - 如果选择在新标签页打开，请允许浏览器弹窗
   - 或者在设置中选择"在当前标签页打开"

## 测试覆盖

本功能包含完整的测试套件：

- **10个单元测试** - 测试核心逻辑
- **8个集成测试** - 测试与Chrome API的交互
- **6个E2E测试** - 测试真实浏览器环境

所有测试都已通过 ✅

## 相关文件

- `history.html` - 历史记录页面UI
- `history.js` - 历史记录逻辑（包含总结功能）
- `content.js` - 转写页面脚本（支持跳过提示词模板）
- `db.js` - IndexedDB数据库操作

## 版本历史

- v4.7.0 - 2024-10-21：首次发布浏览记录总结功能


