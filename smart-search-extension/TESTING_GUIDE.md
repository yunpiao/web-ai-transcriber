# 浏览记录功能测试指南

## 安装和加载扩展

1. 打开 Chrome 浏览器
2. 访问 `chrome://extensions/`
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择 `smart-search-extension` 文件夹

## 测试步骤

### 测试1：启用功能

1. 点击扩展图标，进入设置页面
2. 勾选"启用浏览记录功能（停留5秒自动记录网页内容）"
3. 点击"保存"按钮
4. ✅ 应该看到"选项已保存"的提示

### 测试2：自动记录功能

1. 打开任意网页（如：https://www.baidu.com）
2. 保持页面可见，等待至少5秒
3. 打开浏览器控制台（F12）
4. 切换到"Console"标签
5. ✅ 应该看到类似这样的日志：
   ```
   [页面追踪] 页面停留超过5秒，开始记录
   [页面追踪] 页面访问已记录
   ```

### 测试3：防重复记录

1. 在同一个标签页停留超过5秒
2. 检查控制台
3. ✅ 应该看到"此页面已记录，跳过"的日志
4. 刷新页面（F5）
5. 再次等待5秒
6. ✅ 应该会重新记录（因为刷新清空了sessionStorage）

### 测试4：页面可见性检测

1. 打开一个新网页
2. 等待3秒后，切换到其他标签页
3. 等待5秒后，切换回来
4. 再等待3秒
5. ✅ 应该被记录（累计可见时间：3秒 + 3秒 > 5秒）

### 测试5：查看历史记录

1. 访问多个不同的网页（每个停留5秒以上）
2. 回到扩展设置页面
3. 点击"📖 查看浏览历史记录"链接
4. ✅ 应该看到：
   - 所有访问过的页面列表
   - 按日期分组（今天、昨天等）
   - 每条记录显示标题、URL、时间、域名
   - 页面内容摘要

### 测试6：搜索功能

1. 在历史记录页面的搜索框输入关键词
2. ✅ 记录列表应该实时筛选
3. 清空搜索框
4. ✅ 应该显示所有记录

### 测试7：删除单条记录

1. 点击任意记录的"删除"按钮
2. 确认删除对话框
3. ✅ 该记录应该从列表中消失
4. ✅ 统计数字应该更新

### 测试8：清空所有记录

1. 点击顶部的"清空所有记录"按钮
2. 确认对话框
3. ✅ 所有记录应该被清空
4. ✅ 应该显示空状态提示

### 测试9：导出数据

1. 访问几个网页，确保有记录
2. 在历史记录页面点击"导出数据"按钮
3. ✅ 应该下载一个JSON文件
4. 打开文件检查内容
5. ✅ 应该包含所有记录的完整信息

### 测试10：关闭功能

1. 回到设置页面
2. 取消勾选"启用浏览记录功能"
3. 保存设置
4. 访问新网页并停留5秒
5. 检查控制台
6. ✅ 应该看到"功能未启用"的日志
7. ✅ 不应该记录新的页面

## 验证数据存储

1. 打开 Chrome DevTools（F12）
2. 切换到"Application"标签
3. 展开"IndexedDB"
4. 找到"PageHistoryDB"数据库
5. 展开"pageHistory"对象存储
6. ✅ 应该看到所有保存的记录

## 常见问题排查

### 问题：页面没有被记录

检查项：
- [ ] 功能是否已启用？
- [ ] 页面是否停留了5秒以上？
- [ ] 页面是否保持可见（当前激活的标签页）？
- [ ] 控制台是否有错误信息？

### 问题：历史记录页面显示空白

检查项：
- [ ] 是否有记录数据？
- [ ] 控制台是否有错误？
- [ ] 浏览器是否支持IndexedDB？

### 问题：导出功能不工作

检查项：
- [ ] 浏览器是否允许下载？
- [ ] 是否有记录可以导出？
- [ ] 控制台是否有错误？

## 性能检查

1. 访问一个网页
2. 打开 Chrome 任务管理器（Shift+Esc）
3. 找到扩展进程
4. ✅ CPU占用应该接近0%
5. ✅ 内存占用应该很小（几MB）

## 清理测试数据

测试完成后，可以：
1. 在历史记录页面点击"清空所有记录"
2. 或在 `chrome://extensions/` 中移除扩展
3. 或在浏览器设置中清除网站数据

---

## 测试清单

- [ ] 功能启用/关闭
- [ ] 5秒自动记录
- [ ] 防重复记录
- [ ] 页面可见性检测
- [ ] 历史记录显示
- [ ] 搜索功能
- [ ] 删除单条
- [ ] 清空所有
- [ ] 导出数据
- [ ] 数据持久化
- [ ] 性能表现

全部通过 ✅ 功能正常！

