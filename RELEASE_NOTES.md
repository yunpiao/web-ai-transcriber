# 版本更新日志

## 版本 4.8 (2025-10-21)

### 🎉 新增功能：浏览时长记录

#### 功能描述
在原有浏览记录功能基础上，新增**智能时长追踪**，自动记录您在每个页面的实际停留时间。

#### 主要特性

1. **前台时长计时**
   - 只计算页面在前台可见的时间
   - 切换标签页时自动暂停计时
   - 返回页面时继续累加时长

2. **智能累加**
   - 同一页面多次查看会累加总时长
   - 刷新页面后继续追踪（同一标签页内）
   - 使用sessionStorage维持追踪状态

3. **定期保存**
   - 每30秒自动保存一次当前时长
   - 页面关闭时保存最终时长
   - 防止数据丢失

4. **时长显示**
   - 历史记录页面显示停留时长
   - 智能格式化：秒/分/小时
   - 视觉标识：⏱️ 图标 + 绿色标签

#### 数据结构变化

**数据库升级**: 版本 1 → 2

**新增字段**:
- `duration`: 停留时长（秒）
- `lastUpdateTime`: 最后更新时间

#### 时长格式化规则

| 时长范围 | 显示格式 | 示例 |
|---------|---------|------|
| < 60秒 | X秒 | 30秒 |
| 60秒 - 1小时 | X分Y秒 | 2分30秒 |
| >= 1小时 | X小时Y分 | 1小时15分 |

#### 测试覆盖
- ✅ **单元测试**: 17个（时长格式化、计算逻辑）
- ✅ **集成测试**: 12个（数据库操作、消息通信）
- ✅ **E2E测试**: 4个（真实环境验证）
- ✅ **总计**: 33个新增测试

#### 性能影响
- **CPU**: 每秒更新一次变量（影响极小）
- **内存**: 增加几个变量（<1KB）
- **磁盘I/O**: 每30秒写一次数据库
- **总体**: 几乎无感知 ✅

#### 向后兼容
- ✅ 旧记录自动添加 `duration: 0`
- ✅ 旧记录显示"未记录"
- ✅ 数据库自动升级，不破坏现有数据

---

## 版本 4.7 (2025-10-21)

### 🎉 新增功能：自动浏览记录

#### 功能描述
新增了智能浏览记录功能，可以自动记录您浏览的网页内容，方便后续回顾和管理。

#### 主要特性

1. **自动记录机制**
   - 当您在网页停留超过5秒时，自动保存页面信息
   - 只在页面可见状态下计时（切换标签页会暂停计时）
   - 智能防重复：同一标签页的同一URL只记录一次

2. **记录内容**
   - 页面标题
   - 完整URL
   - 网站图标（favicon）
   - 网页文本内容（完整提取）
   - 访问时间戳
   - 域名信息

3. **历史记录页面**
   - 现代化卡片式界面设计
   - 按日期智能分组（今天、昨天、本周、更早）
   - 实时搜索功能（支持标题、URL、域名）
   - 单条删除和批量清空功能
   - 数据导出功能（JSON格式）

4. **隐私保护**
   - 所有数据存储在本地（IndexedDB）
   - 不上传任何数据到服务器
   - 可随时关闭功能或清除数据
   - 功能默认关闭，需手动启用

#### 技术实现

**新增文件**:
- `tracker.js` - 页面追踪脚本（content script）
- `db.js` - IndexedDB数据库管理模块
- `history.html` - 历史记录展示页面
- `history.js` - 历史记录管理脚本

**修改文件**:
- `manifest.json` - 添加权限（activeTab, tabs）和注册content script
- `background.js` - 添加消息监听和数据库操作
- `options.html` - 添加功能开关UI
- `options.js` - 添加配置项保存/读取逻辑

**新增权限**:
- `activeTab` - 获取当前激活标签页信息
- `tabs` - 访问标签页API

#### 使用方法

1. **启用功能**
   - 打开扩展设置页面
   - 勾选"启用浏览记录功能（停留5秒自动记录网页内容）"
   - 点击保存

2. **查看记录**
   - 在设置页面点击"📖 查看浏览历史记录"链接
   - 或直接访问 history.html 页面

3. **管理记录**
   - 使用搜索框筛选记录
   - 点击标题或"访问"按钮打开网页
   - 使用"删除"按钮移除单条记录
   - 使用"清空所有记录"清除全部数据
   - 使用"导出数据"备份记录

#### 数据存储
- **存储方式**：IndexedDB（浏览器本地数据库）
- **数据库名**：PageHistoryDB
- **存储对象**：pageHistory
- **存储容量**：取决于浏览器配额（通常几百MB到几GB）

#### 性能影响
- 极小的CPU占用（仅在页面加载和计时时）
- 极小的内存占用（约几KB）
- 不影响页面加载速度
- 异步存储，不阻塞UI

#### 兼容性
- Chrome 88+
- 支持所有网站（http/https）
- 不支持chrome://等特殊页面
- 隐身模式下不工作（扩展限制）

---

## 版本 4.6 (2025年初)

### 新特性
- ✅ 支持多种AI平台：Google Gemini、通义千问、DeepSeek、Grok
- ✅ 自定义提示词功能，可根据需求调整AI处理指令
- ✅ 深度思考/搜索功能开关，获得更全面的处理结果
- ✅ 支持通过扩展图标点击触发搜索
- ✅ 支持在当前页面跳转或新标签页打开两种模式

### 功能说明
- **便捷操作**：右键菜单和扩展图标两种方式启动
- **AI平台支持**：兼容多种主流AI服务
- **自定义提示词**：灵活定制AI处理指令
- **灵活浏览模式**：可选择当前页面转写或新标签页打开

### 安装方法
1. 下载Release附带的zip文件
2. 打开Chrome浏览器，输入 `chrome://extensions/`
3. 开启"开发者模式"（右上角开关）
4. 将下载的zip文件拖放到浏览器中，或点击"加载已解压的扩展程序"并选择解压后的文件夹
5. 完成安装后，可在右上角看到扩展图标

### 使用方法
- 在网页上右键，选择"使用 AI 转写网页内容"
- 或直接点击浏览器工具栏上的扩展图标
- 在扩展选项中可进行详细设置

### 常见问题
- 如遇到无法正常工作的情况，请确认已登录所选择的AI平台
- 不同AI平台可能有不同的处理速度和结果质量

---

## 系统要求

- Chrome 浏览器 88 版本及以上
- 需要网络连接以访问 AI 服务平台

## 隐私说明

本扩展不会收集或存储您的任何个人数据。所有处理过程均在您选择的 AI 平台上进行，扩展仅负责传递网页内容。浏览记录功能的所有数据存储在本地IndexedDB，不上传任何数据到服务器。

## 后续计划

- [ ] 添加浏览记录导入功能
- [ ] 添加标签/分类功能
- [ ] 添加统计分析（访问时长、网站排名等）
- [ ] 添加收藏/星标功能
- [ ] 支持全文搜索
- [ ] 添加自动清理策略（如保留最近N天）
- [ ] 更多AI平台支持

---

如有问题或建议，请通过 Chrome 商店页面与我们联系。

**让网页内容转写变得简单而智能！** ✨
